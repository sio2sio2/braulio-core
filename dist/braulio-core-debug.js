!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("gapi")):"function"==typeof define&&define.amd?define("B",["gapi"],e):"object"==typeof exports?exports.B=e(require("gapi")):t.B=e(t.gapi)}(window,(function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(e,n){e.exports=t},function(t,e,n){"use strict";(function(t){function n(t){this.params=t,this.identity=null,this._events={}}n.prototype.init=function(){t.load("client:auth2",()=>{t.client.init(this.params).then(()=>{t.auth2.getAuthInstance().isSignedIn.listen(t=>this._updateSigninStatus(t)),this._updateSigninStatus(this._isSignedIn()),(this._events.succeed||[]).forEach(t=>t.call(this,{type:"succeed",target:this}))},t=>{(this._events.failed||[]).forEach(e=>e.call(this,{type:"failed",target:this,error:t}))})})},n.prototype.addEventListener=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},n.prototype._updateSigninStatus=function(e){let n=e;if(e){n="signedin";const e=t.auth2.getAuthInstance().currentUser.get().getBasicProfile();this.identity={email:e.getEmail(),name:e.getName()}}else n="signedout",this.identity=null;(this._events[n]||[]).forEach(t=>t.call(this,{type:n,target:this}))},n.prototype._isSignedIn=function(){return t.auth2.getAuthInstance().isSignedIn.get()},n.prototype.signin=function(){t.auth2.getAuthInstance().signIn()},n.prototype.signout=function(){t.auth2.getAuthInstance().signOut()},n.prototype.domain=function(){return this.identity?this.identity.email.split("@")[1]:null},e.a=n}).call(this,n(0))},function(t,e,n){"use strict";n.r(e),function(t){function i(e,n,i){function r(t,e){for(e=e.split(".");e.length>0;)t=t[e.shift()];return t}async function*o(){const o=Object.assign({},e);let s=i;o.params=Object.assign({},e.params);do{for(var a=await new Promise((e,i)=>{t.client.request(o).then((function(t){o.params.pageToken=t.result.nextPageToken,e(r(t,n))}),t=>i(t))});a&&a.length;)yield a.shift();s&&(s-=o.params.maxResults)}while(o.params.pageToken&&(void 0===s||s>0))}return e.params.maxResults=Math.min(i||e.params.maxResults,e.params.maxResults),{iter:o,get:function(){return new Promise(async(t,e)=>{const n=[];try{for await(const t of o())n.push(t)}catch(t){e(t)}t(n)})}}}function r(t){const e=(t=t||{}).limit;delete t.limit;return i({path:"https://www.googleapis.com/admin/directory/v1/users",method:"GET",params:t=Object.assign({customer:"my_customer",orderBy:"email",maxResults:500},t)},"result.users",e)}function o(t){const e=(t=t||{}).limit;delete t.limit,(t=Object.assign({customer:"my_customer",orderBy:"email",maxResults:200},t)).userKey&&delete t.customer;return i({path:"https://www.googleapis.com/admin/directory/v1/groups",method:"GET",params:t},"result.groups",e)}function s(t,e){const n=(e=e||{}).limit;delete e.limit;return i({path:"https://www.googleapis.com/admin/directory/v1/groups/"+t+"/members",method:"GET",params:e=Object.assign({includeDerivedMembership:!1,maxResults:200},e)},"result.members",n)}async function a(e){const n=t.client.newBatch(),i=await s(e).get();for(const r of i)n.add(t.client.directory.members.delete({groupKey:e,memberKey:r.email}),{id:r.email});return new Promise(t=>{i.length?n.then(e=>{t(Object.fromEntries(Object.entries(e.result).map(([t,e])=>[t,e.result&&e.result.error||{code:e.status,message:"OK"}])))}):t({})})}function c(e,n){return new Promise(i=>{function r(r){n=n.filter((t,e)=>n.indexOf(t)===e);const o=t.client.newBatch(),s=n.map(n=>t.client.directory.members.insert({groupKey:e.email,email:n}));for(let t=0;t<n.length;t++)o.add(s[t],{id:n[t]});o.then(t=>{var e=Object.fromEntries(Object.entries(t.result).map(([t,e])=>[t,e.result.error||{code:e.status,message:"OK"}]));i(Object.assign(r,{members:e}))})}t.client.directory.groups.insert(e).then(t=>r({dpto:{code:t.status,message:null}}),t=>r({dpto:t.result.error}))})}async function u(e,n){const i=t.client.newBatch(),r=n.map(t=>t.email);if((n=n.filter((t,e)=>r.indexOf(t.email)===e).map(t=>Object({email:t.email,name:t.nombre,description:"Departamento de "+t.nombre}))).length){n.forEach(e=>{i.add(t.client.request({path:"https://www.googleapis.com/admin/directory/v1/groups",method:"POST",body:e}),{id:e.email})});try{await new Promise((t,e)=>i.then(e=>t(e),t=>e(t)))}catch(t){console.warn("Todos los departamentos estaban ya creados")}}return c({email:e,name:"Departamentos didácticos",description:"Todos los departamentos didácticos y de familia profesional"},n.map(t=>t.email))}function l(e){t.client.request({path:"https://www.googleapis.com/groups/v1/groups/"+e,method:"GET",params:{alt:"JSON"}}).then(t=>console.log(t.body),t=>console.log(t))}function p(e,n){t.client.newBatch();e.forEach(t=>{})}function d(t,e,n){}n.d(e,"obtUsuarios",(function(){return r})),n.d(e,"obtGrupos",(function(){return o})),n.d(e,"listarMiembros",(function(){return s})),n.d(e,"vaciarGrupo",(function(){return a})),n.d(e,"poblarGrupo",(function(){return c})),n.d(e,"crearDepartamentos",(function(){return u})),n.d(e,"testGroupsRequest",(function(){return l})),n.d(e,"crearProfesores",(function(){return p})),n.d(e,"crearAlumnos",(function(){return d}))}.call(this,n(0))},function(t,e,n){"use strict";(function(t){function n(e){Object.defineProperties(this,{_id:{enumerable:!1,writable:!0,value:null},id:{get:function(){return this._id||(this._id=function(e){return new Promise((n,i)=>{t.client.request({path:"https://www.googleapis.com/drive/v3/files",method:"GET",params:{spaces:"appDataFolder",q:"name = '"+e+"'"}}).then(r=>{const o=r.result.files;switch(o.length){case 0:console.warn("No hay configuración previa");const r={name:e,parents:["appDataFolder"],description:"Configuración de Braulio",mimeType:"application/json"};t.client.request({path:"https://www.googleapis.com/drive/v3/files",method:"POST",body:r}).then(e=>{const i=e.result.id;t.client.request({path:"https://www.googleapis.com/upload/drive/v3/files/"+i,method:"PATCH",body:"{}"}).then(t=>n(i))});break;case 1:n(o[0].id);break;default:i("Hay más de un fichero de configuración")}})})}(e)),this._id}}})}n.prototype.read=function(){return new Promise(async e=>{const n=await this.id;t.client.request({path:"https://www.googleapis.com/drive/v3/files/"+n,method:"GET",params:{alt:"media"}}).then(t=>e(t.result))})},n.prototype.write=function(e){return new Promise(async n=>{t.client.request({path:"https://www.googleapis.com/upload/drive/v3/files/"+await this.id,method:"PATCH",body:JSON.stringify(e)}).then(t=>n(t))})},n.prototype.remove=function(){return new Promise(async e=>{t.client.request({path:"https://www.googleapis.com/drive/v3/files/"+await this.id,method:"DELETE"}).then(t=>{this._id=null,e(t)})})},e.a=n}).call(this,n(0))},function(t,e,n){"use strict";n.r(e);var i=n(1),r=n(2),o=n(3);e.default=function(t,e){const n=new i.a(Object.assign(e,{discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/admin/directory_v1/rest"],scope:"https://www.googleapis.com/auth/admin.directory.user https://www.googleapis.com/auth/admin.directory.group https://www.googleapis.com/auth/apps.groups.settings https://www.googleapis.com/auth/drive.appdata"}));return n.addEventListener("signedin",e=>e.target.config=new o.a(t)),n.addEventListener("signedout",t=>t.target.config=null),n.api=r,n}}]).default}));
//# sourceMappingURL=braulio-core-debug.js.map